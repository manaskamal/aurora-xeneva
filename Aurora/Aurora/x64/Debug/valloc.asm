; Listing generated by Microsoft (R) Optimizing Compiler Version 17.00.50727.1 

include listing.inc

INCLUDELIB LIBCMT
INCLUDELIB OLDNAMES

PUBLIC	?valloc@@YAX_K@Z				; valloc
PUBLIC	?vfree@@YAX_K@Z					; vfree
EXTRN	AuPmmngrAlloc:PROC
EXTRN	x64_cli:PROC
EXTRN	AuMapPage:PROC
EXTRN	AuUnmapPage:PROC
pdata	SEGMENT
$pdata$?valloc@@YAX_K@Z DD imagerel $LN4
	DD	imagerel $LN4+50
	DD	imagerel $unwind$?valloc@@YAX_K@Z
$pdata$?vfree@@YAX_K@Z DD imagerel $LN3
	DD	imagerel $LN3+31
	DD	imagerel $unwind$?vfree@@YAX_K@Z
pdata	ENDS
xdata	SEGMENT
$unwind$?valloc@@YAX_K@Z DD 010901H
	DD	06209H
$unwind$?vfree@@YAX_K@Z DD 010901H
	DD	04209H
xdata	ENDS
; Function compile flags: /Odtpy
; File e:\xeneva project\xeneva\aurora\aurora\sysserv\valloc.cpp
_TEXT	SEGMENT
pos$ = 48
?vfree@@YAX_K@Z PROC					; vfree

; 17   : void vfree (uint64_t pos) {

$LN3:
	mov	QWORD PTR [rsp+8], rcx
	sub	rsp, 40					; 00000028H

; 18   : 	x64_cli();

	call	x64_cli

; 19   : 	AuUnmapPage((uint64_t)pos, true);

	mov	dl, 1
	mov	rcx, QWORD PTR pos$[rsp]
	call	AuUnmapPage

; 20   : }

	add	rsp, 40					; 00000028H
	ret	0
?vfree@@YAX_K@Z ENDP					; vfree
_TEXT	ENDS
; Function compile flags: /Odtpy
; File e:\xeneva project\xeneva\aurora\aurora\sysserv\valloc.cpp
_TEXT	SEGMENT
p$ = 32
pos$ = 64
?valloc@@YAX_K@Z PROC					; valloc

; 10   : void valloc (uint64_t pos) {

$LN4:
	mov	QWORD PTR [rsp+8], rcx
	sub	rsp, 56					; 00000038H

; 11   : 	x64_cli();

	call	x64_cli

; 12   : 	void *p = AuPmmngrAlloc();

	call	AuPmmngrAlloc
	mov	QWORD PTR p$[rsp], rax

; 13   : 	if (!AuMapPage((uint64_t)p, pos, PAGING_USER))

	mov	r8b, 4
	mov	rdx, QWORD PTR pos$[rsp]
	mov	rcx, QWORD PTR p$[rsp]
	call	AuMapPage
	movzx	eax, al

; 14   : 		return;
; 15   : }

	add	rsp, 56					; 00000038H
	ret	0
?valloc@@YAX_K@Z ENDP					; valloc
_TEXT	ENDS
END
