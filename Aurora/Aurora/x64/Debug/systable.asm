; Listing generated by Microsoft (R) Optimizing Compiler Version 17.00.50727.1 

include listing.inc

INCLUDELIB LIBCMT
INCLUDELIB OLDNAMES

PUBLIC	funct
_BSS	SEGMENT
funct	DQ	01H DUP (?)
_BSS	ENDS
CONST	SEGMENT
$SG3847	DB	'System Call Fault!! Halting System', 0aH, 00H
CONST	ENDS
PUBLIC	x64_syscall_handler
EXTRN	printf:PROC
EXTRN	?message_send@@YAXGPEAU_message_@@@Z:PROC	; message_send
EXTRN	?message_receive@@YAXPEAU_message_@@@Z:PROC	; message_receive
EXTRN	?wait@@YAXXZ:PROC				; wait
EXTRN	?create__sys_process@@YAHPEBDPEAD@Z:PROC	; create__sys_process
EXTRN	?valloc@@YAX_K@Z:PROC				; valloc
EXTRN	?vfree@@YAX_K@Z:PROC				; vfree
EXTRN	?map_shared_memory@@YAXG_K0@Z:PROC		; map_shared_memory
EXTRN	?get_thread_id@@YAGXZ:PROC			; get_thread_id
EXTRN	?sys_unblock_id@@YAXG@Z:PROC			; sys_unblock_id
EXTRN	?create_uthread@@YAXP6AXPEAX@ZPEAD@Z:PROC	; create_uthread
EXTRN	?sys_open_file@@YAHPEADPEAU_file_@@@Z:PROC	; sys_open_file
EXTRN	?sys_read_file@@YAXHPEAEPEAU_file_@@@Z:PROC	; sys_read_file
EXTRN	?sys_write_file@@YAXHPEAEPEAU_file_@@@Z:PROC	; sys_write_file
EXTRN	?sys_get_used_ram@@YA_KXZ:PROC			; sys_get_used_ram
EXTRN	?sys_get_free_ram@@YA_KXZ:PROC			; sys_get_free_ram
EXTRN	?sys_sleep@@YAX_K@Z:PROC			; sys_sleep
EXTRN	?sys_exit@@YAXXZ:PROC				; sys_exit
EXTRN	?fork@@YAIXZ:PROC				; fork
EXTRN	?exec@@YAXPEBDI@Z:PROC				; exec
EXTRN	?ioquery@@YAXHHPEAX@Z:PROC			; ioquery
EXTRN	?sys_get_current_time@@YAXPEAU_sys_time_@@@Z:PROC ; sys_get_current_time
EXTRN	?sys_get_system_tick@@YAIXZ:PROC		; sys_get_system_tick
EXTRN	?sys_kill@@YAXHH@Z:PROC				; sys_kill
EXTRN	?sys_set_signal@@YAXHP6AXH@Z@Z:PROC		; sys_set_signal
EXTRN	?unmap_shared_memory@@YAXG_K0@Z:PROC		; unmap_shared_memory
EXTRN	?sys_attach_ttype@@YAXH@Z:PROC			; sys_attach_ttype
EXTRN	?copy_memory@@YAXG_K0@Z:PROC			; copy_memory
EXTRN	?unmap_memory@@YAXPEAXI@Z:PROC			; unmap_memory
EXTRN	?ttype_create@@YAHPEAH0@Z:PROC			; ttype_create
EXTRN	?ttype_dup_master@@YAXHH@Z:PROC			; ttype_dup_master
EXTRN	?allocate_pipe@@YAXPEAHPEAD@Z:PROC		; allocate_pipe
EXTRN	?create_timer@@YAHIG@Z:PROC			; create_timer
EXTRN	?destroy_timer@@YAXH@Z:PROC			; destroy_timer
EXTRN	?pause_timer@@YAXH@Z:PROC			; pause_timer
EXTRN	?start_timer@@YAXH@Z:PROC			; start_timer
EXTRN	?AuCreateShMem@@YAII_KI@Z:PROC			; AuCreateShMem
EXTRN	?AuObtainShMem@@YAPEAXIPEAXH@Z:PROC		; AuObtainShMem
EXTRN	?au_mmap@@YAPEAXPEAX_K0@Z:PROC			; au_mmap
EXTRN	__ImageBase:BYTE
pdata	SEGMENT
$pdata$x64_syscall_handler DD imagerel $LN48
	DD	imagerel $LN48+956
	DD	imagerel $unwind$x64_syscall_handler
pdata	ENDS
xdata	SEGMENT
$unwind$x64_syscall_handler DD 010801H
	DD	06208H
xdata	ENDS
; Function compile flags: /Odtpy
; File e:\xeneva project\xeneva\aurora\aurora\arch\x86_64\systable.cpp
_TEXT	SEGMENT
idx$ = 32
tv66 = 36
a$ = 64
x64_syscall_handler PROC

; 16   : extern "C" void x64_syscall_handler (int a) {

$LN48:
	mov	DWORD PTR [rsp+8], ecx
	sub	rsp, 56					; 00000038H

; 17   : 
; 18   : 	//! get the index number
; 19   : 	int idx = a;

	mov	eax, DWORD PTR a$[rsp]
	mov	DWORD PTR idx$[rsp], eax

; 20   : 
; 21   : 	//! check for index limit
; 22   : 	if (idx > 256) {

	cmp	DWORD PTR idx$[rsp], 256		; 00000100H
	jle	SHORT $LN44@x64_syscal

; 23   : 		printf ("System Call Fault!! Halting System\n");

	lea	rcx, OFFSET FLAT:$SG3847
	call	printf
$LN43@x64_syscal:

; 24   : 		for(;;);  //Loop forever for now

	jmp	SHORT $LN43@x64_syscal
$LN44@x64_syscal:

; 25   : 	}
; 26   : 
; 27   : 	switch (idx) {

	mov	eax, DWORD PTR idx$[rsp]
	mov	DWORD PTR tv66[rsp], eax
	cmp	DWORD PTR tv66[rsp], 38			; 00000026H
	ja	$LN40@x64_syscal
	movsxd	rax, DWORD PTR tv66[rsp]
	lea	rcx, OFFSET FLAT:__ImageBase
	mov	eax, DWORD PTR $LN47@x64_syscal[rcx+rax*4]
	add	rax, rcx
	jmp	rax
$LN39@x64_syscal:

; 28   : 	case 0:
; 29   : 		funct = (uint64_t*)printf;

	lea	rax, OFFSET FLAT:printf
	mov	QWORD PTR funct, rax

; 30   : 		break;

	jmp	$LN40@x64_syscal
$LN38@x64_syscal:

; 31   : 	case 1:
; 32   : 		funct = (uint64_t*)wait;

	lea	rax, OFFSET FLAT:?wait@@YAXXZ		; wait
	mov	QWORD PTR funct, rax

; 33   : 		break;

	jmp	$LN40@x64_syscal
$LN37@x64_syscal:

; 34   : 	case 2:
; 35   : 		funct = (uint64_t*)create__sys_process;

	lea	rax, OFFSET FLAT:?create__sys_process@@YAHPEBDPEAD@Z ; create__sys_process
	mov	QWORD PTR funct, rax

; 36   : 		break;

	jmp	$LN40@x64_syscal
$LN36@x64_syscal:

; 37   : 	case 3:
; 38   : 		funct = (uint64_t*)copy_memory;

	lea	rax, OFFSET FLAT:?copy_memory@@YAXG_K0@Z ; copy_memory
	mov	QWORD PTR funct, rax

; 39   : 		break;

	jmp	$LN40@x64_syscal
$LN35@x64_syscal:

; 40   : 	case 4:
; 41   : 		funct = (uint64_t*)AuCreateShMem;

	lea	rax, OFFSET FLAT:?AuCreateShMem@@YAII_KI@Z ; AuCreateShMem
	mov	QWORD PTR funct, rax

; 42   : 		break;

	jmp	$LN40@x64_syscal
$LN34@x64_syscal:

; 43   : 	case 5:
; 44   : 		funct = (uint64_t*)valloc;

	lea	rax, OFFSET FLAT:?valloc@@YAX_K@Z	; valloc
	mov	QWORD PTR funct, rax

; 45   : 		break;

	jmp	$LN40@x64_syscal
$LN33@x64_syscal:

; 46   : 	case 6:
; 47   : 		funct = (uint64_t*)message_send;

	lea	rax, OFFSET FLAT:?message_send@@YAXGPEAU_message_@@@Z ; message_send
	mov	QWORD PTR funct, rax

; 48   : 		break;

	jmp	$LN40@x64_syscal
$LN32@x64_syscal:

; 49   : 	case 7:
; 50   : 		funct = (uint64_t*)message_receive;

	lea	rax, OFFSET FLAT:?message_receive@@YAXPEAU_message_@@@Z ; message_receive
	mov	QWORD PTR funct, rax

; 51   : 		break;

	jmp	$LN40@x64_syscal
$LN31@x64_syscal:

; 52   : 	case 8:
; 53   : 		funct = (uint64_t*)map_shared_memory;

	lea	rax, OFFSET FLAT:?map_shared_memory@@YAXG_K0@Z ; map_shared_memory
	mov	QWORD PTR funct, rax

; 54   : 		break;

	jmp	$LN40@x64_syscal
$LN30@x64_syscal:

; 55   : 	case 9:
; 56   : 		funct = (uint64_t*)get_thread_id;

	lea	rax, OFFSET FLAT:?get_thread_id@@YAGXZ	; get_thread_id
	mov	QWORD PTR funct, rax

; 57   : 		break;

	jmp	$LN40@x64_syscal
$LN29@x64_syscal:

; 58   : 	case 10:
; 59   : 		funct = (uint64_t*)create_timer;

	lea	rax, OFFSET FLAT:?create_timer@@YAHIG@Z	; create_timer
	mov	QWORD PTR funct, rax

; 60   : 		break;

	jmp	$LN40@x64_syscal
$LN28@x64_syscal:

; 61   : 	case 11:
; 62   : 		funct = (uint64_t*)destroy_timer;

	lea	rax, OFFSET FLAT:?destroy_timer@@YAXH@Z	; destroy_timer
	mov	QWORD PTR funct, rax

; 63   : 		break;

	jmp	$LN40@x64_syscal
$LN27@x64_syscal:

; 64   : 	case 12:
; 65   : 		funct = (uint64_t*)AuObtainShMem;

	lea	rax, OFFSET FLAT:?AuObtainShMem@@YAPEAXIPEAXH@Z ; AuObtainShMem
	mov	QWORD PTR funct, rax

; 66   : 		break;

	jmp	$LN40@x64_syscal
$LN26@x64_syscal:

; 67   : 	case 13:
; 68   : 		funct = (uint64_t*)ttype_create;

	lea	rax, OFFSET FLAT:?ttype_create@@YAHPEAH0@Z ; ttype_create
	mov	QWORD PTR funct, rax

; 69   : 		break;

	jmp	$LN40@x64_syscal
$LN25@x64_syscal:

; 70   : 	case 14:
; 71   : 		funct = (uint64_t*)start_timer;

	lea	rax, OFFSET FLAT:?start_timer@@YAXH@Z	; start_timer
	mov	QWORD PTR funct, rax

; 72   : 		break;

	jmp	$LN40@x64_syscal
$LN24@x64_syscal:

; 73   : 	case 15:
; 74   : 		funct = (uint64_t*)pause_timer;

	lea	rax, OFFSET FLAT:?pause_timer@@YAXH@Z	; pause_timer
	mov	QWORD PTR funct, rax

; 75   : 		break;

	jmp	$LN40@x64_syscal
$LN23@x64_syscal:

; 76   : 	case 16:
; 77   : 		funct = (uint64_t*)allocate_pipe;

	lea	rax, OFFSET FLAT:?allocate_pipe@@YAXPEAHPEAD@Z ; allocate_pipe
	mov	QWORD PTR funct, rax

; 78   : 		break;

	jmp	$LN40@x64_syscal
$LN22@x64_syscal:

; 79   : 	case 17:
; 80   : 		funct = (uint64_t*)sys_unblock_id;

	lea	rax, OFFSET FLAT:?sys_unblock_id@@YAXG@Z ; sys_unblock_id
	mov	QWORD PTR funct, rax

; 81   : 		break;

	jmp	$LN40@x64_syscal
$LN21@x64_syscal:

; 82   : 	case 18:
; 83   : 		funct = (uint64_t*)create_uthread;

	lea	rax, OFFSET FLAT:?create_uthread@@YAXP6AXPEAX@ZPEAD@Z ; create_uthread
	mov	QWORD PTR funct, rax

; 84   : 		break;

	jmp	$LN40@x64_syscal
$LN20@x64_syscal:

; 85   : 	case 19:
; 86   : 		funct = (uint64_t*)sys_open_file;

	lea	rax, OFFSET FLAT:?sys_open_file@@YAHPEADPEAU_file_@@@Z ; sys_open_file
	mov	QWORD PTR funct, rax

; 87   : 		break;

	jmp	$LN40@x64_syscal
$LN19@x64_syscal:

; 88   : 	case 20:
; 89   : 		funct = (uint64_t*)sys_read_file;

	lea	rax, OFFSET FLAT:?sys_read_file@@YAXHPEAEPEAU_file_@@@Z ; sys_read_file
	mov	QWORD PTR funct, rax

; 90   : 		break;

	jmp	$LN40@x64_syscal
$LN18@x64_syscal:

; 91   : 	case 21:
; 92   : 		funct = (uint64_t*)ttype_dup_master;

	lea	rax, OFFSET FLAT:?ttype_dup_master@@YAXHH@Z ; ttype_dup_master
	mov	QWORD PTR funct, rax

; 93   : 		break;

	jmp	$LN40@x64_syscal
$LN17@x64_syscal:

; 94   : 	case 22:
; 95   : 		funct = (uint64_t*)sys_get_used_ram;

	lea	rax, OFFSET FLAT:?sys_get_used_ram@@YA_KXZ ; sys_get_used_ram
	mov	QWORD PTR funct, rax

; 96   : 		break;

	jmp	$LN40@x64_syscal
$LN16@x64_syscal:

; 97   : 	case 23:
; 98   : 		funct = (uint64_t*)sys_get_free_ram;

	lea	rax, OFFSET FLAT:?sys_get_free_ram@@YA_KXZ ; sys_get_free_ram
	mov	QWORD PTR funct, rax

; 99   : 		break;

	jmp	$LN40@x64_syscal
$LN15@x64_syscal:

; 100  : 	case 24:
; 101  : 		funct = (uint64_t*)sys_sleep;

	lea	rax, OFFSET FLAT:?sys_sleep@@YAX_K@Z	; sys_sleep
	mov	QWORD PTR funct, rax

; 102  : 		break;

	jmp	$LN40@x64_syscal
$LN14@x64_syscal:

; 103  : 	case 25:
; 104  : 		funct = (uint64_t*)sys_exit;

	lea	rax, OFFSET FLAT:?sys_exit@@YAXXZ	; sys_exit
	mov	QWORD PTR funct, rax

; 105  : 		break;

	jmp	$LN40@x64_syscal
$LN13@x64_syscal:

; 106  : 	case 26:
; 107  : 		funct = (uint64_t*)sys_attach_ttype;

	lea	rax, OFFSET FLAT:?sys_attach_ttype@@YAXH@Z ; sys_attach_ttype
	mov	QWORD PTR funct, rax

; 108  : 		break;

	jmp	$LN40@x64_syscal
$LN12@x64_syscal:

; 109  : 	case 27:
; 110  : 		funct = (uint64_t*)fork;

	lea	rax, OFFSET FLAT:?fork@@YAIXZ		; fork
	mov	QWORD PTR funct, rax

; 111  : 		break;

	jmp	$LN40@x64_syscal
$LN11@x64_syscal:

; 112  : 	case 28:
; 113  : 		funct = (uint64_t*)exec;

	lea	rax, OFFSET FLAT:?exec@@YAXPEBDI@Z	; exec
	mov	QWORD PTR funct, rax

; 114  : 		break;

	jmp	$LN40@x64_syscal
$LN10@x64_syscal:

; 115  : 	case 29:
; 116  : 		funct = (uint64_t*)au_mmap;

	lea	rax, OFFSET FLAT:?au_mmap@@YAPEAXPEAX_K0@Z ; au_mmap
	mov	QWORD PTR funct, rax

; 117  : 		break;

	jmp	$LN40@x64_syscal
$LN9@x64_syscal:

; 118  : 	case 30:
; 119  : 		funct = (uint64_t*)unmap_memory;

	lea	rax, OFFSET FLAT:?unmap_memory@@YAXPEAXI@Z ; unmap_memory
	mov	QWORD PTR funct, rax

; 120  : 		break;

	jmp	SHORT $LN40@x64_syscal
$LN8@x64_syscal:

; 121  : 	case 31:
; 122  : 		funct = (uint64_t*)ioquery;

	lea	rax, OFFSET FLAT:?ioquery@@YAXHHPEAX@Z	; ioquery
	mov	QWORD PTR funct, rax

; 123  : 		break;

	jmp	SHORT $LN40@x64_syscal
$LN7@x64_syscal:

; 124  : 	case 32:
; 125  : 		funct = (uint64_t*)sys_get_current_time;

	lea	rax, OFFSET FLAT:?sys_get_current_time@@YAXPEAU_sys_time_@@@Z ; sys_get_current_time
	mov	QWORD PTR funct, rax

; 126  : 		break;

	jmp	SHORT $LN40@x64_syscal
$LN6@x64_syscal:

; 127  : 	case 33:
; 128  : 		funct = (uint64_t*)sys_get_system_tick;

	lea	rax, OFFSET FLAT:?sys_get_system_tick@@YAIXZ ; sys_get_system_tick
	mov	QWORD PTR funct, rax

; 129  : 		break;

	jmp	SHORT $LN40@x64_syscal
$LN5@x64_syscal:

; 130  : 	case 34:
; 131  : 		funct = (uint64_t*)sys_kill;

	lea	rax, OFFSET FLAT:?sys_kill@@YAXHH@Z	; sys_kill
	mov	QWORD PTR funct, rax

; 132  : 		break;

	jmp	SHORT $LN40@x64_syscal
$LN4@x64_syscal:

; 133  : 	case 35:
; 134  : 		funct = (uint64_t*)sys_set_signal;

	lea	rax, OFFSET FLAT:?sys_set_signal@@YAXHP6AXH@Z@Z ; sys_set_signal
	mov	QWORD PTR funct, rax

; 135  : 		break;

	jmp	SHORT $LN40@x64_syscal
$LN3@x64_syscal:

; 136  : 	case 36:
; 137  : 		funct = (uint64_t*)unmap_shared_memory;

	lea	rax, OFFSET FLAT:?unmap_shared_memory@@YAXG_K0@Z ; unmap_shared_memory
	mov	QWORD PTR funct, rax

; 138  : 		break;

	jmp	SHORT $LN40@x64_syscal
$LN2@x64_syscal:

; 139  : 	case 37:
; 140  : 		funct = (uint64_t*)sys_write_file;

	lea	rax, OFFSET FLAT:?sys_write_file@@YAXHPEAEPEAU_file_@@@Z ; sys_write_file
	mov	QWORD PTR funct, rax

; 141  : 		break;

	jmp	SHORT $LN40@x64_syscal
$LN1@x64_syscal:

; 142  : 	case 38:
; 143  : 		funct = (uint64_t*)vfree;

	lea	rax, OFFSET FLAT:?vfree@@YAX_K@Z	; vfree
	mov	QWORD PTR funct, rax
$LN40@x64_syscal:

; 144  : 		break;
; 145  : 	}
; 146  : 
; 147  : 	
; 148  : 	//! update the function pointer to syscall table index
; 149  : 	//funct = (uint64_t*)_syscalls[idx];
; 150  : 
; 151  : 	//return to the caller
; 152  : }

	add	rsp, 56					; 00000038H
	ret	0
$LN47@x64_syscal:
	DD	$LN39@x64_syscal
	DD	$LN38@x64_syscal
	DD	$LN37@x64_syscal
	DD	$LN36@x64_syscal
	DD	$LN35@x64_syscal
	DD	$LN34@x64_syscal
	DD	$LN33@x64_syscal
	DD	$LN32@x64_syscal
	DD	$LN31@x64_syscal
	DD	$LN30@x64_syscal
	DD	$LN29@x64_syscal
	DD	$LN28@x64_syscal
	DD	$LN27@x64_syscal
	DD	$LN26@x64_syscal
	DD	$LN25@x64_syscal
	DD	$LN24@x64_syscal
	DD	$LN23@x64_syscal
	DD	$LN22@x64_syscal
	DD	$LN21@x64_syscal
	DD	$LN20@x64_syscal
	DD	$LN19@x64_syscal
	DD	$LN18@x64_syscal
	DD	$LN17@x64_syscal
	DD	$LN16@x64_syscal
	DD	$LN15@x64_syscal
	DD	$LN14@x64_syscal
	DD	$LN13@x64_syscal
	DD	$LN12@x64_syscal
	DD	$LN11@x64_syscal
	DD	$LN10@x64_syscal
	DD	$LN9@x64_syscal
	DD	$LN8@x64_syscal
	DD	$LN7@x64_syscal
	DD	$LN6@x64_syscal
	DD	$LN5@x64_syscal
	DD	$LN4@x64_syscal
	DD	$LN3@x64_syscal
	DD	$LN2@x64_syscal
	DD	$LN1@x64_syscal
x64_syscall_handler ENDP
_TEXT	ENDS
END
