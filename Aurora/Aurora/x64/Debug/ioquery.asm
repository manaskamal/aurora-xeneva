; Listing generated by Microsoft (R) Optimizing Compiler Version 17.00.50727.1 

include listing.inc

INCLUDELIB LIBCMT
INCLUDELIB OLDNAMES

PUBLIC	?ioquery@@YAXHHPEAX@Z				; ioquery
EXTRN	?vfs_ioquery@@YAHPEAU_vfs_node_@@HPEAX@Z:PROC	; vfs_ioquery
EXTRN	x64_cli:PROC
EXTRN	?get_current_thread@@YAPEAU_thread_@@XZ:PROC	; get_current_thread
pdata	SEGMENT
$pdata$?ioquery@@YAXHHPEAX@Z DD imagerel $LN4
	DD	imagerel $LN4+77
	DD	imagerel $unwind$?ioquery@@YAXHHPEAX@Z
pdata	ENDS
xdata	SEGMENT
$unwind$?ioquery@@YAXHHPEAX@Z DD 011101H
	DD	06211H
xdata	ENDS
; Function compile flags: /Odtpy
; File e:\xeneva project\xeneva\aurora\aurora\sysserv\ioquery.cpp
_TEXT	SEGMENT
node$ = 32
device_id$ = 64
code$ = 72
arg$ = 80
?ioquery@@YAXHHPEAX@Z PROC				; ioquery

; 22   : void ioquery (int device_id, int code, void* arg) {

$LN4:
	mov	QWORD PTR [rsp+24], r8
	mov	DWORD PTR [rsp+16], edx
	mov	DWORD PTR [rsp+8], ecx
	sub	rsp, 56					; 00000038H

; 23   : 	x64_cli();

	call	x64_cli

; 24   : 	vfs_node_t *node = get_current_thread()->fd[device_id];

	call	?get_current_thread@@YAPEAU_thread_@@XZ	; get_current_thread
	movsxd	rcx, DWORD PTR device_id$[rsp]
	mov	rax, QWORD PTR [rax+rcx*8+272]
	mov	QWORD PTR node$[rsp], rax

; 25   : 	if (node) 

	cmp	QWORD PTR node$[rsp], 0
	je	SHORT $LN1@ioquery

; 26   : 		vfs_ioquery(node, code, arg);

	mov	r8, QWORD PTR arg$[rsp]
	mov	edx, DWORD PTR code$[rsp]
	mov	rcx, QWORD PTR node$[rsp]
	call	?vfs_ioquery@@YAHPEAU_vfs_node_@@HPEAX@Z ; vfs_ioquery
$LN1@ioquery:

; 27   : 	return;
; 28   : }

	add	rsp, 56					; 00000038H
	ret	0
?ioquery@@YAXHHPEAX@Z ENDP				; ioquery
_TEXT	ENDS
END
