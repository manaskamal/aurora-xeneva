; Listing generated by Microsoft (R) Optimizing Compiler Version 17.00.50727.1 

include listing.inc

INCLUDELIB LIBCMT
INCLUDELIB OLDNAMES

PUBLIC	?ethernet_send@@YAXPEAX_KGPEAE@Z		; ethernet_send
EXTRN	memcpy:PROC
EXTRN	?AuNetWrite@@YAXPEA_K_K@Z:PROC			; AuNetWrite
EXTRN	?AuGetNetTuple@@YAPEAU_au_net_@@XZ:PROC		; AuGetNetTuple
EXTRN	malloc:PROC
EXTRN	free:PROC
pdata	SEGMENT
$pdata$?ethernet_send@@YAXPEAX_KGPEAE@Z DD imagerel $LN3
	DD	imagerel $LN3+211
	DD	imagerel $unwind$?ethernet_send@@YAXPEAX_KGPEAE@Z
pdata	ENDS
xdata	SEGMENT
$unwind$?ethernet_send@@YAXPEAX_KGPEAE@Z DD 011901H
	DD	08219H
xdata	ENDS
; Function compile flags: /Odtpy
; File e:\xeneva project\xeneva\aurora\aurora\net\ethernet.cpp
_TEXT	SEGMENT
packet$ = 32
total_sz$ = 40
src_mac$ = 48
data$ = 80
len$ = 88
type$ = 96
dest$ = 104
?ethernet_send@@YAXPEAX_KGPEAE@Z PROC			; ethernet_send

; 41   : void ethernet_send (void* data, size_t len, uint16_t type, uint8_t* dest) {

$LN3:
	mov	QWORD PTR [rsp+32], r9
	mov	WORD PTR [rsp+24], r8w
	mov	QWORD PTR [rsp+16], rdx
	mov	QWORD PTR [rsp+8], rcx
	sub	rsp, 72					; 00000048H

; 42   : 	size_t total_sz = sizeof(ethernet_t) + len;

	mov	rax, QWORD PTR len$[rsp]
	add	rax, 14
	mov	QWORD PTR total_sz$[rsp], rax

; 43   : 	ethernet_t* packet = (ethernet_t*)malloc(total_sz);

	mov	rcx, QWORD PTR total_sz$[rsp]
	call	malloc
	mov	QWORD PTR packet$[rsp], rax

; 44   : 	memcpy(packet + 1, data, len);

	mov	rax, QWORD PTR packet$[rsp]
	add	rax, 14
	mov	r8, QWORD PTR len$[rsp]
	mov	rdx, QWORD PTR data$[rsp]
	mov	rcx, rax
	call	memcpy

; 45   : 	memcpy(packet->dest, dest,6);

	mov	rax, QWORD PTR packet$[rsp]
	mov	r8d, 6
	mov	rdx, QWORD PTR dest$[rsp]
	mov	rcx, rax
	call	memcpy

; 46   : 	uint8_t *src_mac = AuGetNetTuple()->mac;

	call	?AuGetNetTuple@@YAPEAU_au_net_@@XZ	; AuGetNetTuple
	mov	QWORD PTR src_mac$[rsp], rax

; 47   : 	memcpy(packet->src,src_mac,6);

	mov	rax, QWORD PTR packet$[rsp]
	add	rax, 6
	mov	r8d, 6
	mov	rdx, QWORD PTR src_mac$[rsp]
	mov	rcx, rax
	call	memcpy

; 48   : 	packet->type_len = htons(type);

	movzx	eax, WORD PTR type$[rsp]
	and	eax, 255				; 000000ffH
	shl	eax, 8
	movzx	ecx, WORD PTR type$[rsp]
	and	ecx, 65280				; 0000ff00H
	sar	ecx, 8
	or	eax, ecx
	mov	rcx, QWORD PTR packet$[rsp]
	mov	WORD PTR [rcx+12], ax

; 49   : 	AuNetWrite((uint64_t*)packet,total_sz);

	mov	rdx, QWORD PTR total_sz$[rsp]
	mov	rcx, QWORD PTR packet$[rsp]
	call	?AuNetWrite@@YAXPEA_K_K@Z		; AuNetWrite

; 50   : 	free(packet);

	mov	rcx, QWORD PTR packet$[rsp]
	call	free

; 51   : }

	add	rsp, 72					; 00000048H
	ret	0
?ethernet_send@@YAXPEAX_KGPEAE@Z ENDP			; ethernet_send
_TEXT	ENDS
END
