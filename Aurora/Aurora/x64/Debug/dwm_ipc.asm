; Listing generated by Microsoft (R) Optimizing Compiler Version 17.00.50727.1 

include listing.inc

INCLUDELIB LIBCMT
INCLUDELIB OLDNAMES

PUBLIC	?dwm_queue@@3PA_KA				; dwm_queue
_BSS	SEGMENT
?dwm_queue@@3PA_KA DQ 0200H DUP (?)			; dwm_queue
_BSS	ENDS
PUBLIC	?dwm_ipc_init@@YAXXZ				; dwm_ipc_init
PUBLIC	?dwm_put_message@@YAXPEAU_dwm_message_@@@Z	; dwm_put_message
PUBLIC	?dwm_dispatch_message@@YAXPEAU_dwm_message_@@@Z	; dwm_dispatch_message
PUBLIC	?get_dwm_message_q_address@@YAPEA_KXZ		; get_dwm_message_q_address
EXTRN	?memset@@YAXPEAXEI@Z:PROC			; memset
EXTRN	memcpy:PROC
EXTRN	?pmmngr_alloc@@YAPEAXXZ:PROC			; pmmngr_alloc
EXTRN	x64_cli:PROC
EXTRN	?map_page@@YA_N_K0E@Z:PROC			; map_page
EXTRN	?get_current_thread@@YAPEAU_thread_@@XZ:PROC	; get_current_thread
EXTRN	?is_multi_task_enable@@YA_NXZ:PROC		; is_multi_task_enable
EXTRN	?thread_iterate_ready_list@@YAPEAU_thread_@@G@Z:PROC ; thread_iterate_ready_list
EXTRN	?thread_iterate_block_list@@YAPEAU_thread_@@H@Z:PROC ; thread_iterate_block_list
pdata	SEGMENT
$pdata$?dwm_ipc_init@@YAXXZ DD imagerel $LN3
	DD	imagerel $LN3+111
	DD	imagerel $unwind$?dwm_ipc_init@@YAXXZ
$pdata$?dwm_put_message@@YAXPEAU_dwm_message_@@@Z DD imagerel $LN6
	DD	imagerel $LN6+122
	DD	imagerel $unwind$?dwm_put_message@@YAXPEAU_dwm_message_@@@Z
$pdata$?dwm_dispatch_message@@YAXPEAU_dwm_message_@@@Z DD imagerel $LN4
	DD	imagerel $LN4+94
	DD	imagerel $unwind$?dwm_dispatch_message@@YAXPEAU_dwm_message_@@@Z
pdata	ENDS
xdata	SEGMENT
$unwind$?dwm_ipc_init@@YAXXZ DD 010401H
	DD	06204H
$unwind$?dwm_put_message@@YAXPEAU_dwm_message_@@@Z DD 010901H
	DD	06209H
$unwind$?dwm_dispatch_message@@YAXPEAU_dwm_message_@@@Z DD 010901H
	DD	06209H
xdata	ENDS
; Function compile flags: /Odtpy
; File e:\xeneva project\xeneva\aurora\aurora\ipc\dwm_ipc.cpp
_TEXT	SEGMENT
?get_dwm_message_q_address@@YAPEA_KXZ PROC		; get_dwm_message_q_address

; 29   : 	return 0;

	xor	eax, eax

; 30   : }

	ret	0
?get_dwm_message_q_address@@YAPEA_KXZ ENDP		; get_dwm_message_q_address
_TEXT	ENDS
; Function compile flags: /Odtpy
; File e:\xeneva project\xeneva\aurora\aurora\ipc\dwm_ipc.cpp
_TEXT	SEGMENT
tmsg$ = 32
msg$ = 64
?dwm_dispatch_message@@YAXPEAU_dwm_message_@@@Z PROC	; dwm_dispatch_message

; 45   : void dwm_dispatch_message (dwm_message_t *msg) {

$LN4:
	mov	QWORD PTR [rsp+8], rcx
	sub	rsp, 56					; 00000038H

; 46   : 	x64_cli();

	call	x64_cli

; 47   : 	dwm_message_t *tmsg = (dwm_message_t*)get_current_thread()->msg_box;

	call	?get_current_thread@@YAPEAU_thread_@@XZ	; get_current_thread
	mov	rax, QWORD PTR [rax+248]
	mov	QWORD PTR tmsg$[rsp], rax

; 48   : 	if (tmsg->type != 0) {

	mov	rax, QWORD PTR tmsg$[rsp]
	movzx	eax, WORD PTR [rax]
	test	eax, eax
	je	SHORT $LN1@dwm_dispat

; 49   : 		memcpy (msg,tmsg,sizeof(dwm_message_t));

	mov	r8d, 28
	mov	rdx, QWORD PTR tmsg$[rsp]
	mov	rcx, QWORD PTR msg$[rsp]
	call	memcpy

; 50   : 		memset (get_current_thread()->msg_box, 0, 4096);

	call	?get_current_thread@@YAPEAU_thread_@@XZ	; get_current_thread
	mov	r8d, 4096				; 00001000H
	xor	edx, edx
	mov	rcx, QWORD PTR [rax+248]
	call	?memset@@YAXPEAXEI@Z			; memset
$LN1@dwm_dispat:

; 51   : 	}
; 52   : 	
; 53   : }

	add	rsp, 56					; 00000038H
	ret	0
?dwm_dispatch_message@@YAXPEAU_dwm_message_@@@Z ENDP	; dwm_dispatch_message
_TEXT	ENDS
; Function compile flags: /Odtpy
; File e:\xeneva project\xeneva\aurora\aurora\ipc\dwm_ipc.cpp
_TEXT	SEGMENT
t$ = 32
tmsg$ = 40
msg$ = 64
?dwm_put_message@@YAXPEAU_dwm_message_@@@Z PROC		; dwm_put_message

; 31   : void dwm_put_message (dwm_message_t *msg) {

$LN6:
	mov	QWORD PTR [rsp+8], rcx
	sub	rsp, 56					; 00000038H

; 32   : 	if (!is_multi_task_enable())

	call	?is_multi_task_enable@@YA_NXZ		; is_multi_task_enable
	movzx	eax, al
	test	eax, eax
	jne	SHORT $LN3@dwm_put_me

; 33   : 		return;

	jmp	SHORT $LN4@dwm_put_me
$LN3@dwm_put_me:

; 34   : 
; 35   : 	thread_t *t  = thread_iterate_ready_list (2);   //!ready list

	mov	cx, 2
	call	?thread_iterate_ready_list@@YAPEAU_thread_@@G@Z ; thread_iterate_ready_list
	mov	QWORD PTR t$[rsp], rax

; 36   : 	if (t == NULL) {

	cmp	QWORD PTR t$[rsp], 0
	jne	SHORT $LN2@dwm_put_me

; 37   : 		t = thread_iterate_block_list(2);

	mov	ecx, 2
	call	?thread_iterate_block_list@@YAPEAU_thread_@@H@Z ; thread_iterate_block_list
	mov	QWORD PTR t$[rsp], rax
$LN2@dwm_put_me:

; 38   : 	}
; 39   : 	dwm_message_t *tmsg = (dwm_message_t*)t->msg_box;

	mov	rax, QWORD PTR t$[rsp]
	mov	rax, QWORD PTR [rax+248]
	mov	QWORD PTR tmsg$[rsp], rax

; 40   : 	if (tmsg->type == 0)

	mov	rax, QWORD PTR tmsg$[rsp]
	movzx	eax, WORD PTR [rax]
	test	eax, eax
	jne	SHORT $LN1@dwm_put_me

; 41   : 		memcpy (t->msg_box,msg,sizeof(dwm_message_t));

	mov	r8d, 28
	mov	rdx, QWORD PTR msg$[rsp]
	mov	rax, QWORD PTR t$[rsp]
	mov	rcx, QWORD PTR [rax+248]
	call	memcpy
$LN1@dwm_put_me:
$LN4@dwm_put_me:

; 42   : }

	add	rsp, 56					; 00000038H
	ret	0
?dwm_put_message@@YAXPEAU_dwm_message_@@@Z ENDP		; dwm_put_message
_TEXT	ENDS
; Function compile flags: /Odtpy
; File e:\xeneva project\xeneva\aurora\aurora\ipc\dwm_ipc.cpp
_TEXT	SEGMENT
p$ = 32
p2$ = 40
?dwm_ipc_init@@YAXXZ PROC				; dwm_ipc_init

; 19   : void dwm_ipc_init () {

$LN3:
	sub	rsp, 56					; 00000038H

; 20   : 	void* p = pmmngr_alloc();

	call	?pmmngr_alloc@@YAPEAXXZ			; pmmngr_alloc
	mov	QWORD PTR p$[rsp], rax

; 21   : 	memset(p, 0, 4096);

	mov	r8d, 4096				; 00001000H
	xor	edx, edx
	mov	rcx, QWORD PTR p$[rsp]
	call	?memset@@YAXPEAXEI@Z			; memset

; 22   : 	map_page((uint64_t)p,0xFFFFFD0000000000, PAGING_USER);

	mov	r8b, 4
	mov	rdx, -3298534883328			; fffffd0000000000H
	mov	rcx, QWORD PTR p$[rsp]
	call	?map_page@@YA_N_K0E@Z			; map_page

; 23   : 	void *p2 = pmmngr_alloc();

	call	?pmmngr_alloc@@YAPEAXXZ			; pmmngr_alloc
	mov	QWORD PTR p2$[rsp], rax

; 24   : 	memset(p2, 0, 4096);

	mov	r8d, 4096				; 00001000H
	xor	edx, edx
	mov	rcx, QWORD PTR p2$[rsp]
	call	?memset@@YAXPEAXEI@Z			; memset

; 25   : 	map_page((uint64_t)p2,0xFFFFD00000000000,PAGING_USER);

	mov	r8b, 4
	mov	rdx, -52776558133248			; ffffd00000000000H
	mov	rcx, QWORD PTR p2$[rsp]
	call	?map_page@@YA_N_K0E@Z			; map_page

; 26   : }

	add	rsp, 56					; 00000038H
	ret	0
?dwm_ipc_init@@YAXXZ ENDP				; dwm_ipc_init
_TEXT	ENDS
END
