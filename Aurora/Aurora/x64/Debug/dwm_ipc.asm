; Listing generated by Microsoft (R) Optimizing Compiler Version 17.00.50727.1 

include listing.inc

INCLUDELIB LIBCMT
INCLUDELIB OLDNAMES

PUBLIC	?dwm_queue@@3PA_KA				; dwm_queue
_BSS	SEGMENT
?dwm_queue@@3PA_KA DQ 0200H DUP (?)			; dwm_queue
_BSS	ENDS
PUBLIC	?dwm_ipc_init@@YAXXZ				; dwm_ipc_init
PUBLIC	?dwm_put_message@@YAXPEAU_dwm_message_@@@Z	; dwm_put_message
PUBLIC	?dwm_dispatch_message@@YAXPEAU_dwm_message_@@@Z	; dwm_dispatch_message
PUBLIC	?get_dwm_message_q_address@@YAPEA_KXZ		; get_dwm_message_q_address
EXTRN	?memset@@YAXPEAXEI@Z:PROC			; memset
EXTRN	memcpy:PROC
EXTRN	x64_cli:PROC
EXTRN	?get_current_thread@@YAPEAU_thread_@@XZ:PROC	; get_current_thread
EXTRN	?thread_iterate_ready_list@@YAPEAU_thread_@@G@Z:PROC ; thread_iterate_ready_list
EXTRN	?create_mutex@@YAPEAUmutex_t@@XZ:PROC		; create_mutex
EXTRN	?mutex_lock@@YAXPEAUmutex_t@@@Z:PROC		; mutex_lock
EXTRN	?mutex_unlock@@YAXPEAUmutex_t@@@Z:PROC		; mutex_unlock
_BSS	SEGMENT
msg_mutex DQ	01H DUP (?)
msg_rcv_mutex DQ 01H DUP (?)
_BSS	ENDS
pdata	SEGMENT
$pdata$?dwm_put_message@@YAXPEAU_dwm_message_@@@Z DD imagerel $LN3
	DD	imagerel $LN3+85
	DD	imagerel $unwind$?dwm_put_message@@YAXPEAU_dwm_message_@@@Z
$pdata$?dwm_dispatch_message@@YAXPEAU_dwm_message_@@@Z DD imagerel $LN4
	DD	imagerel $LN4+118
	DD	imagerel $unwind$?dwm_dispatch_message@@YAXPEAU_dwm_message_@@@Z
pdata	ENDS
;	COMDAT pdata
pdata	SEGMENT
$pdata$??__Emsg_mutex@@YAXXZ DD imagerel ??__Emsg_mutex@@YAXXZ
	DD	imagerel ??__Emsg_mutex@@YAXXZ+21
	DD	imagerel $unwind$??__Emsg_mutex@@YAXXZ
pdata	ENDS
;	COMDAT pdata
pdata	SEGMENT
$pdata$??__Emsg_rcv_mutex@@YAXXZ DD imagerel ??__Emsg_rcv_mutex@@YAXXZ
	DD	imagerel ??__Emsg_rcv_mutex@@YAXXZ+21
	DD	imagerel $unwind$??__Emsg_rcv_mutex@@YAXXZ
pdata	ENDS
CRT$XCU	SEGMENT
msg_mutex$initializer$ DQ FLAT:??__Emsg_mutex@@YAXXZ
CRT$XCU	ENDS
;	COMDAT xdata
xdata	SEGMENT
$unwind$??__Emsg_rcv_mutex@@YAXXZ DD 010401H
	DD	04204H
xdata	ENDS
;	COMDAT xdata
xdata	SEGMENT
$unwind$??__Emsg_mutex@@YAXXZ DD 010401H
	DD	04204H
xdata	ENDS
xdata	SEGMENT
$unwind$?dwm_put_message@@YAXPEAU_dwm_message_@@@Z DD 010901H
	DD	06209H
$unwind$?dwm_dispatch_message@@YAXPEAU_dwm_message_@@@Z DD 010901H
	DD	06209H
xdata	ENDS
CRT$XCU	SEGMENT
msg_rcv_mutex$initializer$ DQ FLAT:??__Emsg_rcv_mutex@@YAXXZ
CRT$XCU	ENDS
; Function compile flags: /Odtp
; File e:\xeneva project\xeneva\aurora\aurora\ipc\dwm_ipc.cpp
;	COMDAT ??__Emsg_rcv_mutex@@YAXXZ
text$yc	SEGMENT
??__Emsg_rcv_mutex@@YAXXZ PROC				; `dynamic initializer for 'msg_rcv_mutex'', COMDAT

; 18   : static mutex_t *msg_rcv_mutex = create_mutex();

	sub	rsp, 40					; 00000028H
	call	?create_mutex@@YAPEAUmutex_t@@XZ	; create_mutex
	mov	QWORD PTR msg_rcv_mutex, rax
	add	rsp, 40					; 00000028H
	ret	0
??__Emsg_rcv_mutex@@YAXXZ ENDP				; `dynamic initializer for 'msg_rcv_mutex''
text$yc	ENDS
; Function compile flags: /Odtp
; File e:\xeneva project\xeneva\aurora\aurora\ipc\dwm_ipc.cpp
;	COMDAT ??__Emsg_mutex@@YAXXZ
text$yc	SEGMENT
??__Emsg_mutex@@YAXXZ PROC				; `dynamic initializer for 'msg_mutex'', COMDAT

; 17   : static mutex_t *msg_mutex = create_mutex ();

	sub	rsp, 40					; 00000028H
	call	?create_mutex@@YAPEAUmutex_t@@XZ	; create_mutex
	mov	QWORD PTR msg_mutex, rax
	add	rsp, 40					; 00000028H
	ret	0
??__Emsg_mutex@@YAXXZ ENDP				; `dynamic initializer for 'msg_mutex''
text$yc	ENDS
; Function compile flags: /Odtp
; File e:\xeneva project\xeneva\aurora\aurora\ipc\dwm_ipc.cpp
_TEXT	SEGMENT
?get_dwm_message_q_address@@YAPEA_KXZ PROC		; get_dwm_message_q_address

; 25   : 	return 0;

	xor	eax, eax

; 26   : }

	ret	0
?get_dwm_message_q_address@@YAPEA_KXZ ENDP		; get_dwm_message_q_address
_TEXT	ENDS
; Function compile flags: /Odtp
; File e:\xeneva project\xeneva\aurora\aurora\ipc\dwm_ipc.cpp
_TEXT	SEGMENT
tmsg$ = 32
msg$ = 64
?dwm_dispatch_message@@YAXPEAU_dwm_message_@@@Z PROC	; dwm_dispatch_message

; 37   : void dwm_dispatch_message (dwm_message_t *msg) {

$LN4:
	mov	QWORD PTR [rsp+8], rcx
	sub	rsp, 56					; 00000038H

; 38   : 	x64_cli();

	call	x64_cli

; 39   : 	mutex_lock (msg_rcv_mutex);

	mov	rcx, QWORD PTR msg_rcv_mutex
	call	?mutex_lock@@YAXPEAUmutex_t@@@Z		; mutex_lock

; 40   : 	dwm_message_t *tmsg = (dwm_message_t*)get_current_thread()->mouse_box;

	call	?get_current_thread@@YAPEAU_thread_@@XZ	; get_current_thread
	mov	rax, QWORD PTR [rax+240]
	mov	QWORD PTR tmsg$[rsp], rax

; 41   : 	if (tmsg->type != 0) {

	mov	rax, QWORD PTR tmsg$[rsp]
	movzx	eax, WORD PTR [rax]
	test	eax, eax
	je	SHORT $LN1@dwm_dispat

; 42   : 		memcpy (msg,tmsg,sizeof(dwm_message_t));

	mov	r8d, 28
	mov	rdx, QWORD PTR tmsg$[rsp]
	mov	rcx, QWORD PTR msg$[rsp]
	call	memcpy
$LN1@dwm_dispat:

; 43   : 	}
; 44   : 
; 45   : 	memset (get_current_thread()->mouse_box, 0, sizeof(dwm_message_t));

	call	?get_current_thread@@YAPEAU_thread_@@XZ	; get_current_thread
	mov	r8d, 28
	xor	edx, edx
	mov	rcx, QWORD PTR [rax+240]
	call	?memset@@YAXPEAXEI@Z			; memset

; 46   : 	mutex_unlock (msg_rcv_mutex);

	mov	rcx, QWORD PTR msg_rcv_mutex
	call	?mutex_unlock@@YAXPEAUmutex_t@@@Z	; mutex_unlock

; 47   : }

	add	rsp, 56					; 00000038H
	ret	0
?dwm_dispatch_message@@YAXPEAU_dwm_message_@@@Z ENDP	; dwm_dispatch_message
_TEXT	ENDS
; Function compile flags: /Odtp
; File e:\xeneva project\xeneva\aurora\aurora\ipc\dwm_ipc.cpp
_TEXT	SEGMENT
t$ = 32
msg$ = 64
?dwm_put_message@@YAXPEAU_dwm_message_@@@Z PROC		; dwm_put_message

; 27   : void dwm_put_message (dwm_message_t *msg) {

$LN3:
	mov	QWORD PTR [rsp+8], rcx
	sub	rsp, 56					; 00000038H

; 28   : 	x64_cli ();

	call	x64_cli

; 29   : 	mutex_lock (msg_mutex);

	mov	rcx, QWORD PTR msg_mutex
	call	?mutex_lock@@YAXPEAUmutex_t@@@Z		; mutex_lock

; 30   : 	thread_t *t  = thread_iterate_ready_list (1);   //!ready list

	mov	cx, 1
	call	?thread_iterate_ready_list@@YAPEAU_thread_@@G@Z ; thread_iterate_ready_list
	mov	QWORD PTR t$[rsp], rax

; 31   : 	memcpy (t->mouse_box,msg,sizeof(dwm_message_t));

	mov	r8d, 28
	mov	rdx, QWORD PTR msg$[rsp]
	mov	rax, QWORD PTR t$[rsp]
	mov	rcx, QWORD PTR [rax+240]
	call	memcpy

; 32   : 	mutex_unlock (msg_mutex);

	mov	rcx, QWORD PTR msg_mutex
	call	?mutex_unlock@@YAXPEAUmutex_t@@@Z	; mutex_unlock

; 33   : 
; 34   : }

	add	rsp, 56					; 00000038H
	ret	0
?dwm_put_message@@YAXPEAU_dwm_message_@@@Z ENDP		; dwm_put_message
_TEXT	ENDS
; Function compile flags: /Odtp
; File e:\xeneva project\xeneva\aurora\aurora\ipc\dwm_ipc.cpp
_TEXT	SEGMENT
?dwm_ipc_init@@YAXXZ PROC				; dwm_ipc_init

; 21   : 
; 22   : }

	ret	0
?dwm_ipc_init@@YAXXZ ENDP				; dwm_ipc_init
_TEXT	ENDS
END
